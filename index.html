<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>livraria - cadastro de livro</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2 id="form-title">cadastro de livro</h2>
    <form id="form-livro">
        <input type="hidden" id="id-livro">
        <label for="titulo">título <input type="text" id="titulo" name="titulo"></label>
        <label for="autor">autor <input type="text" id="autor" name="autor"></label>
        <label for="ano-publicacao">ano de publicação <input type="number" id="ano-publicacao" name="ano-publicacao"></label>
        <label for="genero">gênero <input type="text" id="genero" name="genero"></label>
        <label for="idioma">idioma <input type="text" id="idioma" name="idioma"></label>
        <label for="preco">preço <input type="number" step="0.01" id="preco" name="preco"></label>
        <button type="button" id="btn-cadastrar" onclick="enviar()">cadastrar</button>
        <button type="button" id="btn-editar" onclick="editar()" style="display:none;">salvar edição</button>
        <button type="button" onclick="limparFormulario()">limpar</button>
        <button type="button" onclick="irParaLista()">ver lista de livros</button>
    </form>

    <script>
        // funções de cadastro, edição e limpeza permanecem
        function enviar(){
            let titulo = document.getElementById('titulo').value;
            let autor = document.getElementById('autor').value;
            let ano_publicacao = document.getElementById('ano-publicacao').value;
            let genero = document.getElementById('genero').value;
            let idioma = document.getElementById('idioma').value;
            let preco = document.getElementById('preco').value;

            if(!titulo || !autor || !ano_publicacao || !genero || !idioma || !preco){
                alert("preencha todos os campos corretamente!");
                return;
            }
            
            fetch("http://localhost:3000/livros", {
                method: "post",
                headers: {"content-type": "application/json"},
                body: JSON.stringify({
                    titulo, autor, ano_publicacao, genero, idioma, preco
                })
            })
            .then(response => response.json())
            .then(function (data) {
                alert(`livro cadastrado com sucesso!`);
                limparFormulario();
            })
        }

        function editar(){
            let id = document.getElementById('id-livro').value;
            let titulo = document.getElementById('titulo').value;
            let autor = document.getElementById('autor').value;
            let ano_publicacao = document.getElementById('ano-publicacao').value;
            let genero = document.getElementById('genero').value;
            let idioma = document.getElementById('idioma').value;
            let preco = document.getElementById('preco').value;

            fetch(`http://localhost:3000/livros/${id}`, {
                method: "put",
                headers: {"content-type": "application/json"},
                body: JSON.stringify({
                    titulo, autor, ano_publicacao, genero, idioma, preco
                })
            })
            .then(response => response.json())
            .then(function (data) {
                limparFormulario();
            });
        }

        function limparFormulario(){
            document.getElementById('form-livro').reset();
            document.getElementById('id-livro').value = "";
            document.getElementById('btn-cadastrar').style.display = "inline";
            document.getElementById('btn-editar').style.display = "none";
            document.getElementById('form-title').innerText = "cadastro de livro";
        }

        function irParaLista(){
            window.location.href = "usuarios.html";
        }
    </script>
</body>
</html>
